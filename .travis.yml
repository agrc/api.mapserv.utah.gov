version: ~> 1.0
dist: xenial
os: linux
language: csharp
env:
  - CLI_VERSION=5.0.100-preview.8.20417.9
addons:
  apt:
    packages:
      - liblttng-ust0
      - zlib1g
jobs:
  include:
    - mono: none
      solution: api.mapserv.utah.gov.sln
      install:
        - export DOTNET_INSTALL_DIR="$PWD/.dotnetcli"
        - curl -sSL https://dot.net/v1/dotnet-install.sh | bash /dev/stdin --version "$CLI_VERSION" --install-dir "$DOTNET_INSTALL_DIR"
        - export PATH="$DOTNET_INSTALL_DIR:$PATH"
      script:
        - dotnet test /p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput=../../coverage.xml /p:Configuration=Release api.mapserv.utah.gov.sln
      after_success:
        - bash <(curl -s https://codecov.io/bash)
    - language: node_js
      node_js: lts/*
      cache:
        directories:
        -  src/explorer/node_modules
      before_install: cd src/explorer
    - language: node_js
      node_js: node
      cache:
        directories:
        -  src/explorer/node_modules
      before_install: cd src/explorer

notifications:
  email:
    on_success: change
    on_failure: change
